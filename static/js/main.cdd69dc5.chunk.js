(this["webpackJsonpbangumi-ratings"]=this["webpackJsonpbangumi-ratings"]||[]).push([[0],{180:function(e,t){e.exports={APPLICATION_ID:"54T0X4tWovUBdnRd6EKdW3BrN4WJrpGBEJdwDk9J",JAVASCRIPT_KEY:"WREbi60D2GfVknGhH9Je1GJ931oIhIVkHUXD9u5R",SERVER_URL:"https://parseapi.back4app.com/"}},364:function(e,t,a){},365:function(e,t,a){},369:function(e,t,a){},370:function(e,t,a){},371:function(e,t,a){},372:function(e,t,a){},373:function(e,t,a){},374:function(e,t,a){},376:function(e,t,a){},377:function(e,t,a){},378:function(e,t,a){},379:function(e,t,a){},604:function(e,t){},606:function(e,t){},61:function(e,t,a){},617:function(e,t){},619:function(e,t){},646:function(e,t){},648:function(e,t){},649:function(e,t){},654:function(e,t){},656:function(e,t){},675:function(e,t){},687:function(e,t){},690:function(e,t){},736:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),l=a(118),c=a.n(l),u=(a(364),a(26)),i=a.n(u),o=a(60),s=a(6),m=a(180),d=a(69),E=a(232),f=Object(n.createContext)(null);function p(){return Object(n.useContext)(f)}a(365),a(61);function b(){var e=p(),t=e.authenticated,a=e.setAuthenticating,n=e.handleSignOut;return t?r.a.createElement("div",{id:"user-management"},r.a.createElement("div",{className:"text-button clickable",onClick:n},"\u6ce8\u9500")):r.a.createElement("div",{className:"text-button clickable",onClick:function(){return a(!0)}},"\u767b\u9646")}var v=function(e){return r.a.createElement(E.a,{sticky:"top",expand:"lg",id:"navbar"},r.a.createElement(E.a.Brand,{href:"/"},"\u8ffd\u756a\u8865\u756a"),r.a.createElement(d.a,{className:"mr-auto",activeKey:window.location.pathname},r.a.createElement(d.a.Item,null,r.a.createElement(d.a.Link,{onClick:function(){return e.switchPage("AnimeList")}},"\u8865\u756a\u5217\u8868")),r.a.createElement(d.a.Item,null,r.a.createElement(d.a.Link,{onClick:function(){return e.switchPage("NewAnimeList")}},"\u8ffd\u756a\u5217\u8868")),r.a.createElement(d.a.Item,null,r.a.createElement(d.a.Link,{onClick:function(){return e.switchPage("MonthlySummary")}},"\u6bcf\u6708\u603b\u7ed3")),r.a.createElement(d.a.Item,null,r.a.createElement(d.a.Link,{onClick:function(){return e.switchPage("SeasonalSummary")}},"\u5b63\u5ea6\u603b\u7ed3"))),r.a.createElement(b,null))},g={ratings:[],newAnimes:[],monthlySummaries:{}},h=r.a.createContext(g),y=a(121),O=a(9),j=a(14),_=a(3),w=a(176),k=a(59);function N(e){return r.a.createElement("th",{key:e.header},r.a.createElement("div",{className:"table-header"},r.a.createElement("div",null,e.header),r.a.createElement(k.b,{className:"icon clickable",onClick:e.sort})))}var S=a(120);a(369);function C(e){var t=Object(n.useState)(!1),a=Object(s.a)(t,2),l=a[0],c=a[1];return l?r.a.createElement("div",{className:"filter-box"},r.a.createElement("input",{className:"filter-input-box",placeholder:"\u8f93\u5165......",type:"text",onKeyPress:function(t){"Enter"===t.key&&e.filter(t)}}),r.a.createElement("div",{className:"close-button clickable",onClick:function(){e.clearFilter(),c(!l)}},"\xd7")):r.a.createElement(S.a,{className:"filter-box icon clickable",onClick:function(){return c(!l)}})}a(370);function L(e){return r.a.createElement("th",{key:e.header},r.a.createElement("div",{className:"table-header"},r.a.createElement("div",null,e.header),r.a.createElement(C,{filter:e.filter,clearFilter:e.clearFilter})))}a(371);function x(e){var t=e.description;return void 0===t||null===t?r.a.createElement("p",null,"\u6682\u65e0\u7b80\u4ecb"):r.a.createElement("div",{className:"description"},r.a.createElement("div",null,r.a.createElement("h1",null,t.name,r.a.createElement("a",{href:"https://www.douban.com/search?q="+t.name,target:"_blank",rel:"noopener noreferrer"},r.a.createElement(S.a,{className:"icon clickable"}))),r.a.createElement("p",null,"\u8c46\u74e3\u8bc4\u5206\uff1a",t.douban),r.a.createElement("p",null,"\u5e74\u4efd\uff1a",t.year),r.a.createElement("p",null,"\u5206\u7c7b\uff1a",t.genre),r.a.createElement("p",null,"\u96c6\u6570\uff1a",t.episodes),r.a.createElement("p",null,"\u5355\u96c6\u7247\u957f\uff1a",t.episode_length),r.a.createElement("p",null,"\u7b80\u4ecb\uff1a",t.description)))}var A=a(18);a(372);function V(e){var t=void 0===e.oldValue||null===e.oldValue?{}:e.oldValue;return r.a.createElement(_.a,{onSubmit:function(t){e.onSubmitOrEdit(t,e.id)}},r.a.createElement(_.a.Group,{controlId:"name"},r.a.createElement(_.a.Label,null,"\u540d\u79f0"),r.a.createElement(_.a.Control,{defaultValue:t.name,type:"input"})),r.a.createElement(_.a.Group,null,r.a.createElement(_.a.Row,{className:"input-row"},r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u8c46\u74e3\u8bc4\u5206",r.a.createElement("a",{href:"https://www.douban.com",target:"_blank",rel:"noopener noreferrer"},r.a.createElement(S.a,{className:"icon clickable"}))),r.a.createElement(_.a.Control,{defaultValue:t.douban,id:"douban",type:"input"})),r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u5e74\u4efd"),r.a.createElement(_.a.Control,{defaultValue:t.year,id:"year",type:"input"})),r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u72b6\u6001"),r.a.createElement(_.a.Control,{defaultValue:t.status,id:"status",type:"input"}))),r.a.createElement(_.a.Row,{className:"input-row"},r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u5206\u7c7b"),r.a.createElement(_.a.Control,{defaultValue:t.genre,id:"genre",type:"input"})),r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"TV\u96c6\u6570"),r.a.createElement(_.a.Control,{defaultValue:t.tv_episodes,id:"tv_episodes",type:"input"})),r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u5267\u573a\u7248"),r.a.createElement(_.a.Control,{defaultValue:t.movies,id:"movies",type:"input"})),r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u5355\u96c6\u7247\u957f"),r.a.createElement(_.a.Control,{defaultValue:t.episode_length,id:"episode_length",type:"input"})))),r.a.createElement(_.a.Group,null,r.a.createElement(_.a.Label,null,"\u7b80\u4ecb"),r.a.createElement(_.a.Control,{defaultValue:t.description,id:"description",as:"textarea",rows:"3"})),r.a.createElement(_.a.Group,null,r.a.createElement(_.a.Row,{className:"input-row"},r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u5267\u60c5\u8bc4\u5206"),r.a.createElement(_.a.Control,{defaultValue:t.story,id:"story",type:"input"})),r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u4f5c\u753b\u8bc4\u5206"),r.a.createElement(_.a.Control,{defaultValue:t.story,id:"illustration",type:"input"})),r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u97f3\u4e50\u8bc4\u5206"),r.a.createElement(_.a.Control,{defaultValue:t.music,id:"music",type:"input"})),r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u60c5\u6000\u8bc4\u5206"),r.a.createElement(_.a.Control,{defaultValue:t.passion,id:"passion",type:"input"})))),r.a.createElement(_.a.Group,null,r.a.createElement(_.a.Row,{className:"input-row"},r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u5f00\u59cb\u89c2\u770b\u65e5\u671f"),r.a.createElement(_.a.Control,{defaultValue:t.start_date,id:"start_date",type:"input"})),r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u7ed3\u675f\u89c2\u770b\u65e5\u671f"),r.a.createElement(_.a.Control,{defaultValue:t.end_date,id:"end_date",type:"input"})),r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u89c2\u770b\u6b21\u6570"),r.a.createElement(_.a.Control,{defaultValue:t.times_watched,id:"times_watched",type:"input"})))),r.a.createElement(j.a,{className:"pink-button",type:"submit"},"\u63d0\u4ea4"))}function Y(e,t){return void 0===e||void 0===t?"":0===e?"\u5267\u573a\u7248\xd7".concat(t):0===t?"".concat(e,"\u96c6"):"".concat(e,"\u96c6+\u5267\u573a\u7248\xd7").concat(t)}function I(e){return isNaN(e)?"-":e>=60?Math.round(e/60*10)/10+" \u5c0f\u65f6":Math.round(10*e)/10+" \u5206\u949f"}function M(e){var t=e.end_date.diff(e.start_date,"days")+1,a=void 0===e.episode_length||0===e.episode_length?24:e.episode_length;return(e.tv_episodes*a+90*e.movies)/t}function D(e){switch(e){case"\u540d\u79f0":return"name";case"\u96c6\u6570":case"\u9884\u8ba1\u96c6\u6570":return"tv_episodes";case"\u72b6\u6001":return"status";case"\u5206\u7c7b":return"genre";case"\u5267\u60c5":return"story";case"\u4f5c\u753b":return"illustration";case"\u97f3\u4e50":return"music";case"\u60c5\u6000":return"passion";case"\u8bc4\u5206":return"rating";case"\u9996\u6b21\u89c2\u770b\u65e5\u671f":return"end_date";case"\u89c2\u770b\u6b21\u6570":return"times_watched";case"\u5e74\u4efd":return"year";case"\u8c46\u74e3\u8bc4\u5206":return"douban";case"\u65e5\u5747\u65f6\u957f":return"daily_time";case"\u6392\u540d":return"ranking";case"\u5b63\u5ea6":return"season";case"\u5f00\u59cb\u653e\u9001\u65e5\u671f":return"start_date";case"\u66f4\u65b0\u65e5":return"next_episode_day";default:return"unknown"}}function R(e,t){return e.slice().sort((function(e,a){var n="daily_time"===t?M(e):e[t],r="daily_time"===t?M(a):a[t];return"start_date"===t&&"string"!==typeof t?n.isValid()?r.isValid()?Q(n,r):-1:1:Q(n,r)}))}function Q(e,t){return e>t?-1:e<t?1:0}a(373);var B=function(e){var t=p().authenticated,a=r.a.useContext(h).ratings,l=["\u5e8f\u53f7","\u540d\u79f0","\u96c6\u6570","\u5206\u7c7b","\u5267\u60c5","\u4f5c\u753b","\u97f3\u4e50","\u60c5\u6000","\u8bc4\u5206","\u9996\u6b21\u89c2\u770b\u65e5\u671f","\u65e5\u5747\u65f6\u957f",""],c=["\u5e8f\u53f7","\u540d\u79f0","\u96c6\u6570","\u5206\u7c7b","\u5e74\u4efd","\u8c46\u74e3\u8bc4\u5206","\u7b80\u4ecb",""],u=Object(n.useState)(null),i=Object(s.a)(u,2),o=i[0],m=i[1],d=Object(n.useState)(!1),E=Object(s.a)(d,2),f=E[0],b=E[1],v=Object(n.useState)(!1),g=Object(s.a)(v,2),S=g[0],C=g[1],A=Object(n.useState)(!1),Q=Object(s.a)(A,2),B=Q[0],F=Q[1],H=Object(n.useState)(!1),T=Object(s.a)(H,2),q=T[0],z=T[1],G=Object(n.useState)(!1),P=Object(s.a)(G,2),J=P[0],U=P[1],W=Object(n.useState)(!1),K=Object(s.a)(W,2),X=K[0],$=K[1],Z=Object(n.useState)({}),ee=Object(s.a)(Z,2),te=ee[0],ae=ee[1],ne=Object(n.useState)(),re=Object(s.a)(ne,2),le=re[0],ce=re[1],ue=Object(n.useState)("\u5df2\u770b"),ie=Object(s.a)(ue,2),oe=ie[0],se=ie[1],me=Object(n.useState)(a),de=Object(s.a)(me,2),Ee=de[0],fe=de[1],pe=Object(n.useState)(l),be=Object(s.a)(pe,2),ve=be[0],ge=be[1],he=Object(n.useState)({}),ye=Object(s.a)(he,2),Oe=ye[0],je=ye[1],_e=Object(n.useState)(),we=Object(s.a)(_e,2),ke=we[0],Ne=we[1],Se=Object(n.useState)(null),Ce=Object(s.a)(Se,2),Le=Ce[0],xe=Ce[1];Object(n.useEffect)((function(){Ne("end_date")}),[]),Object(n.useEffect)((function(){je([]),fe(R(a.filter((function(e){return e.status===oe})),"end_date"))}),[e.isLoading,a,oe]),Object(n.useEffect)((function(){null!==ke?(fe(R(a.filter((function(e){return e.status===oe})),"\u5728\u770b"===oe&&"end_date"===ke?"start_date":ke)),Ne(null)):"\u5728\u770b"===oe&&fe(R(a.filter((function(e){return e.status===oe})),"start_date"))}),[ke,a,oe]),Object(n.useEffect)((function(){if(0!==Oe.length){for(var e=function(){var e=Object(s.a)(n[t],2),r=e[0],l=e[1];fe(a.filter((function(e){return e[r].includes(l)&&e.status===oe})))},t=0,n=Object.entries(Oe);t<n.length;t++)e();je([])}}),[a,Oe,oe]);var Ae=function(e){var t=e.target.innerHTML;ge("\u60f3\u770b"===t?c:l),se(t)};return e.isLoading?r.a.createElement("div",{className:"loading"},r.a.createElement("div",null,"\u6b63\u5728\u52a0\u8f7d......")):e.loadError?r.a.createElement(w.a,{variant:"danger"},"\u756a\u5267\u8bc4\u5206\u52a0\u8f7d\u5931\u8d25\uff01"):r.a.createElement("div",{className:"main-element"},r.a.createElement(O.a,{centered:!0,size:"lg",show:f,onHide:function(){return b(!1)}},r.a.createElement(O.a.Header,null,r.a.createElement(O.a.Title,null,"\u7b80\u4ecb")),r.a.createElement(O.a.Body,null,r.a.createElement(x,{description:o})),r.a.createElement(O.a.Footer,null,r.a.createElement(j.a,{className:"pink-button",onClick:function(){return b(!1)}},"\u5173\u95ed"))),r.a.createElement(O.a,{centered:!0,size:"lg",show:S,onHide:function(){return C(!1)}},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,J?"\u6dfb\u52a0\u65b0\u756a\u5267":"\u7f16\u8f91\u756a\u5267")),r.a.createElement(O.a.Body,null,r.a.createElement(V,{onSubmitOrEdit:function(t,a){t.preventDefault(),J||X?e.onAnimeSubmit(t,null,!0):e.onAnimeSubmit(t,a,!1),C(!1)},oldValue:Le,id:le}))),r.a.createElement(O.a,{centered:!0,size:"lg",show:B,onHide:function(){return F(!1)}},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,"\u6dfb\u52a0\u65b0\u756a\u5267")),r.a.createElement(O.a.Body,null,r.a.createElement(_.a,{onSubmit:function(e){e.preventDefault();var t=function(e){var t=e.split("\n")[5].split(" ")[0],a=e.split("\u9996\u64ad: ")[1].split("-")[0],n=e.split("\u8c46\u74e3\u8bc4\u5206")[1].split("\n")[1],r=12;try{r=parseInt(e.split("\u96c6\u6570: ")[1].split("-")[0])}catch(u){console.error(u)}var l=24;try{l=parseInt(e.split("\u5355\u96c6\u7247\u957f: ")[1].split("-")[0])}catch(u){console.error(u)}var c=e.split("\u7684\u5267\u60c5\u7b80\u4ecb \xb7 \xb7 \xb7 \xb7 \xb7 \xb7")[1].split("\n\n")[1].trim();return{name:t,year:a,douban:n,tv_episodes:isNaN(r)?0:r,episode_length:isNaN(l)?12:l,description:c}}(e.target.elements.html.value);xe({name:t.name,year:t.year,douban:t.douban,tv_episodes:t.tv_episodes,movies:0,episode_length:t.episode_length,status:"\u60f3\u770b",genre:"",description:t.description,story:0,illustration:0,music:0,passion:0,start_date:null,end_date:null,times_watched:0}),$(!0),F(!1),ce(null),C(!0)}},r.a.createElement(_.a.Group,null,r.a.createElement(_.a.Label,null,"\u8c46\u74e3\u9875\u9762\u6e90"),r.a.createElement(_.a.Control,{id:"html",as:"textarea",rows:"10"})),r.a.createElement(j.a,{className:"pink-button",type:"submit"},"\u63d0\u4ea4")))),r.a.createElement(O.a,{centered:!0,size:"sm",show:q,onHide:function(){return z(!1)}},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,"\u5220\u9664\u756a\u5267")),r.a.createElement(O.a.Body,null,r.a.createElement("p",null,"\u786e\u5b9a\u8981\u5220\u9664\u756a\u5267\u201c".concat(te.name,"\u201d\u5417"))),r.a.createElement(O.a.Footer,null,r.a.createElement(j.a,{variant:"primary",onClick:function(){ae({}),z(!1)}},"\u53d6\u6d88"),r.a.createElement(j.a,{variant:"danger",onClick:function(){e.deleteAnime(te.id,"Ratings"),ae({}),z(!1)}},"\u786e\u5b9a"))),r.a.createElement("div",{className:"button-group"},r.a.createElement("div",null,r.a.createElement(j.a,{className:"pink-button",onClick:Ae},"\u5df2\u770b"),r.a.createElement(j.a,{className:"pink-button",onClick:Ae},"\u5728\u770b"),r.a.createElement(j.a,{className:"pink-button",onClick:Ae},"\u60f3\u770b")),r.a.createElement("div",null,t?r.a.createElement(j.a,{className:"pink-button",onClick:function(){xe(null),ce(null),C(!0),U(!0)}},"\u624b\u52a8\u6dfb\u52a0"):r.a.createElement(r.a.Fragment,null),t?r.a.createElement(j.a,{className:"pink-button",onClick:function(){xe(null),ce(null),F(!0),U(!0)}},"\u81ea\u52a8\u6dfb\u52a0"):r.a.createElement(r.a.Fragment,null),r.a.createElement(j.a,{className:"pink-button",onClick:e.refresh},"\u5237\u65b0"))),r.a.createElement("div",null,r.a.createElement(y.a,{striped:!0,borderless:!0,hover:!0,size:"sm",variant:"light",id:"table"},r.a.createElement("thead",null,r.a.createElement("tr",{className:"table-headers"},ve.map((function(e){return"\u540d\u79f0"===e||"\u5206\u7c7b"===e?r.a.createElement(L,{key:e,header:e,filter:function(t){var a={};for(var n in Oe)a[n]=Oe[n];a[D(e)]=t.target.value,je(a)},clearFilter:function(){je([]),fe(R(a.filter((function(e){return e.status===oe})),"end_date"))}}):"\u5e8f\u53f7"===e?r.a.createElement("th",{key:e},"\u5e8f\u53f7"):""!==e?r.a.createElement(N,{key:e,header:e,sort:function(){return Ne(D(e))}}):r.a.createElement("th",{key:e})})))),r.a.createElement("tbody",null,Ee.map((function(e,a){return r.a.createElement("tr",{key:e.name},r.a.createElement("td",null,a+1),r.a.createElement("td",{className:"anime-name clickable",onClick:function(t){m({name:e.name,douban:e.douban,year:e.year,genre:e.genre,episodes:e.tv_episodes,episode_length:e.episode_length,description:e.description}),b(!0)}},e.name),r.a.createElement("td",null,Y(e.tv_episodes,e.movies)),r.a.createElement("td",null,e.genre),r.a.createElement("td",null,"\u60f3\u770b"===oe?e.year:e.story),r.a.createElement("td",null,"\u60f3\u770b"===oe?e.douban:e.illustration),r.a.createElement("td",null,"\u60f3\u770b"===oe?function(e){if(null!==e&&void 0!==e)return e.substring(0,20)+"......"}(e.description):e.music),"\u60f3\u770b"===oe?"":r.a.createElement("td",null,e.passion),"\u60f3\u770b"===oe?"":r.a.createElement("td",null,e.rating),"\u60f3\u770b"===oe?"":r.a.createElement("td",null,(n=e.start_date,l=e.end_date,n.isValid()?l.isValid()?"".concat(n.format("MM/DD/YY")," \u81f3 ").concat(l.format("MM/DD/YY")):"".concat(n.format("MM/DD/YY"),"\u81f3\u4eca"):"")),"\u60f3\u770b"===oe?"":r.a.createElement("td",null,I(M(e))),r.a.createElement("td",null," ",t?r.a.createElement(r.a.Fragment,null,r.a.createElement(k.a,{className:"clickable",onClick:function(){ce(e.id),xe({name:e.name,year:e.year,douban:e.douban,tv_episodes:e.tv_episodes,movies:e.movies,episode_length:e.episode_length,status:e.status,genre:e.genre,description:e.description,story:e.story,illustration:e.illustration,music:e.music,passion:e.passion,start_date:e.start_date.format("YYYY-MM-DD"),end_date:e.end_date.format("YYYY-MM-DD"),times_watched:e.times_watched}),U(!1),C(!0)}}),r.a.createElement(k.c,{className:"icon clickable",onClick:function(){ae({name:e.name,id:e.id}),z(!0)}})):r.a.createElement(r.a.Fragment,null)));var n,l}))))))},F=a(31),H=a.n(F),T=a(231);a(374);function q(e){return r.a.createElement("div",null,r.a.createElement(y.a,{striped:!0,borderless:!0,hover:!0,size:"sm",variant:"light",id:"table"},r.a.createElement("thead",null,r.a.createElement("tr",{className:"table-headers"},r.a.createElement("th",null,"\u6392\u540d"),r.a.createElement("th",null,"\u540d\u79f0"),r.a.createElement("th",null,"\u8c03\u6574\u6392\u540d"))),r.a.createElement("tbody",null,function(e){for(var t=[],a=0,n=Object.entries(e);a<n.length;a++){var r=Object(s.a)(n[a],2),l=r[0],c=r[1];t.push([l,c])}return t.sort((function(e,t){return e[1]-t[1]})),t}(e.rankings).map((function(t){return r.a.createElement("tr",{key:t[0]},r.a.createElement("td",null,t[1]),r.a.createElement("td",{className:"new-anime-name"},t[0]),r.a.createElement("td",{className:"update-ranking-buttons"},r.a.createElement(r.a.Fragment,null,r.a.createElement(j.a,{className:"pink-button",onClick:function(t){return e.changeRanking(t,-1)}},r.a.createElement(T.b,null)),r.a.createElement(j.a,{className:"pink-button",onClick:function(t){return e.changeRanking(t,1)}},r.a.createElement(T.a,null)))))})))))}var z=a(181);a(375),a(376);function G(e){var t=[H()().subtract(1,"days"),H()(),H()().add(1,"days")];return H.a.locale("zh-cn"),r.a.createElement("div",{id:"daily-new-animes"},t.map((function(t){return r.a.createElement(z.a,null,r.a.createElement(z.a.Item,{variant:t.isSame(H()(),"day")?"primary":"dark"},t.format("dddd[\uff0c]YYYY[\u5e74]MMMDo ")),e.displayList.filter((function(e){var a=H()(e.start_date);return t.isAfter(a)&&t.diff(a,"days")%7===0})).map((function(e){return r.a.createElement(z.a.Item,{key:e.name},e.name)})))})))}a(377);function P(e){var t=void 0===e.oldValue||null===e.oldValue?{}:e.oldValue;return r.a.createElement(_.a,{id:"new-anime-modal",onSubmit:function(t){e.onSubmitOrEdit(t,e.id)}},r.a.createElement(_.a.Group,{controlId:"name"},r.a.createElement(_.a.Label,null,"\u540d\u79f0"),r.a.createElement(_.a.Control,{defaultValue:t.name,type:"input"})),r.a.createElement(_.a.Row,{className:"input-row"},r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u5b63\u5ea6"),r.a.createElement(_.a.Control,{defaultValue:t.season,id:"season",type:"input"})),r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u5f00\u59cb\u653e\u9001\u65e5\u671f"),r.a.createElement(_.a.Control,{defaultValue:t.start_date,id:"start_date",type:"input"})),r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u66f4\u65b0\u65e5"),r.a.createElement(_.a.Control,{defaultValue:t.next_episode_day,id:"next_episode_day",type:"input"}))),r.a.createElement(_.a.Group,null,r.a.createElement(_.a.Row,{className:"input-row"},r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u72b6\u6001"),r.a.createElement(_.a.Control,{defaultValue:t.status,id:"status",type:"input"})),r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u5206\u7c7b"),r.a.createElement(_.a.Control,{defaultValue:t.genre,id:"genre",type:"input"})),r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u9884\u8ba1\u96c6\u6570"),r.a.createElement(_.a.Control,{defaultValue:t.tv_episodes,id:"tv_episodes",type:"input"}))),r.a.createElement(_.a.Group,null,r.a.createElement(_.a.Label,null,"\u7b80\u4ecb"),r.a.createElement(_.a.Control,{defaultValue:t.description,id:"description",as:"textarea",rows:"3"}))),r.a.createElement("div",null,r.a.createElement(j.a,{className:"pink-button",type:"submit"},"\u63d0\u4ea4"),e.submitNewAnime?r.a.createElement(r.a.Fragment,null):r.a.createElement(j.a,{onClick:function(){var t=document.getElementById("new-anime-modal").elements;e.handleRateNewAnime({name:t.name.value,tv_episodes:Number(t.tv_episodes.value),genre:t.genre.value,description:t.description.value,start_date:t.start_date.value,status:t.status.value})}},"\u5df2\u8ffd\u5b8c")))}var J=function(e){var t=p().authenticated,a=r.a.useContext(h).newAnimes,l=Object(n.useState)([]),c=Object(s.a)(l,2),u=c[0],i=c[1],o=Object(n.useState)(!1),m=Object(s.a)(o,2),d=m[0],E=m[1],f=Object(n.useState)(!1),b=Object(s.a)(f,2),v=b[0],g=b[1],_=Object(n.useState)(!1),S=Object(s.a)(_,2),C=S[0],L=S[1],x=Object(n.useState)(!1),A=Object(s.a)(x,2),I=A[0],M=A[1],Q=Object(n.useState)(!1),B=Object(s.a)(Q,2),F=B[0],T=B[1],z=Object(n.useState)({}),J=Object(s.a)(z,2),U=J[0],W=J[1],K=Object(n.useState)({}),X=Object(s.a)(K,2),$=X[0],Z=X[1],ee=Object(n.useState)(!1),te=Object(s.a)(ee,2),ae=te[0],ne=te[1],re=Object(n.useState)({}),le=Object(s.a)(re,2),ce=le[0],ue=le[1],ie=Object(n.useState)(),oe=Object(s.a)(ie,2),se=oe[0],me=oe[1],de=Object(n.useState)(a),Ee=Object(s.a)(de,2),fe=Ee[0],pe=Ee[1],be=Object(n.useState)(null),ve=Object(s.a)(be,2),ge=ve[0],he=ve[1],ye=Object(n.useState)(null),Oe=Object(s.a)(ye,2),je=Oe[0],_e=Oe[1],we=Object(n.useState)(null),ke=Object(s.a)(we,2),Ne=ke[0],Se=ke[1],Ce=Object(n.useState)(null),Le=Object(s.a)(Ce,2),xe=Le[0],Ae=Le[1];Object(n.useEffect)((function(){Se("ranking")}),[]);var Ve=function(e){he(e.target.innerHTML)},Ye=function(e,t){e.sort((function(e,a){return t[e.name]>t[a.name]?1:t[e.name]<t[a.name]?-1:0}))};return Object(n.useEffect)((function(){if(null!==Ne){var e=a.filter((function(e){return e.season.includes(ge)}));"ranking"===Ne?(Ye(e,U),pe(e)):pe(R(e,Ne)),Se(null)}}),[Ne,a,ge,U]),Object(n.useEffect)((function(){var e=function(){var e=new Date,t=e.getFullYear(),a=3*Math.floor(e.getMonth()/3)+1,n=t+"\u5e74"+(a-3)+"\u6708",r=t+"\u5e74"+(a+3)+"\u6708";return 1===a&&(n=t-1+"\u5e7410\u6708"),10===a&&(r=t+1+"\u5e741\u6708"),[n,t+"\u5e74"+a+"\u6708",r]}();i(e),he(e[1])}),[]),Object(n.useEffect)((function(){var e=a.filter((function(e){return e.season.includes(ge)})),t=function(e,t){var a={};return e.forEach((function(e){var n=e.seasons_ranking[t],r=Object.keys(n),l=n[r.sort()[r.length-1]];a[e.name]=l})),a}(e,ge);Ye(e,t),pe(e),W(t),Z(t)}),[e.isLoading,a,ge]),e.isLoading?r.a.createElement("div",{className:"loading"},r.a.createElement("div",null,"\u6b63\u5728\u52a0\u8f7d......")):e.loadError?r.a.createElement(w.a,{variant:"danger"},"\u8ffd\u756a\u5217\u8868\u52a0\u8f7d\u5931\u8d25\uff01"):r.a.createElement("div",{className:"main-element"},r.a.createElement(O.a,{centered:!0,size:"lg",show:d,onHide:function(){return E(!1)}},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,ae?"\u6dfb\u52a0\u65b0\u8ffd\u756a":"\u7f16\u8f91\u8ffd\u756a")),r.a.createElement(O.a.Body,null,r.a.createElement(P,{submitNewAnime:ae,onSubmitOrEdit:function(t,a){t.preventDefault(),ae?e.onNewAnimeSubmit(t,null,!0):e.onNewAnimeSubmit(t,a,!1),E(!1)},oldValue:je,id:se,handleRateNewAnime:function(e){e.status="\u5df2\u770b",Ae(e),E(!1),g(!0)}}))),r.a.createElement(O.a,{centered:!0,size:"lg",show:v,onHide:function(){return g(!1)}},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,"\u8bc4\u4ef7\u756a\u5267")),r.a.createElement(O.a.Body,null,r.a.createElement(V,{onSubmitOrEdit:function(t,a){t.preventDefault(),e.onAnimeSubmit(t,a,!0),g(!1)},oldValue:xe,id:se}))),r.a.createElement(O.a,{centered:!0,size:"sm",show:C,onHide:function(){return L(!1)}},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,"\u5220\u9664\u756a\u5267")),r.a.createElement(O.a.Body,null,r.a.createElement("p",null,"\u786e\u5b9a\u8981\u5220\u9664\u756a\u5267\u201c".concat(ce.name,"\u201d\u5417"))),r.a.createElement(O.a.Footer,null,r.a.createElement(j.a,{variant:"primary",onClick:function(){ue({}),L(!1)}},"\u53d6\u6d88"),r.a.createElement(j.a,{variant:"danger",onClick:function(){e.deleteNewAnime(ce.id,"NewAnimes"),ue({}),L(!1)}},"\u786e\u5b9a"))),r.a.createElement(O.a,{centered:!0,size:"lg",show:I,onHide:function(){return M(!1)}},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,"\u756a\u5267\u6392\u540d")),r.a.createElement(O.a.Body,null,r.a.createElement(q,{rankings:$,changeRanking:function(e,t){var a=e.currentTarget.parentElement.parentElement.getElementsByClassName("new-anime-name")[0].innerText,n=$[a],r={},l=!1;if(1===t?l=n!==function(e){for(var t=-1,a=0,n=Object.keys(e);a<n.length;a++){var r=n[a];e[r]>t&&(t=e[r])}return t}($):-1===t&&(l=1!==n),l){for(var c=0,u=Object.entries($);c<u.length;c++){var i=Object(s.a)(u[c],2),o=i[0],m=i[1];r[o]=o===a?n+t:m===n+t?n:m}Z(r)}}})),r.a.createElement(O.a.Footer,null,r.a.createElement(j.a,{variant:"primary",onClick:function(){var t=[],a={},n=H()().format("YYYY-MM-DD");fe.forEach((function(e){t.push(e.id);var r=Object.assign({},e.seasons_ranking);r[ge][n]=$[e.name],a[e.id]=r})),e.updateNewAnimesRankings(t,a,ge),M(!1)}},"\u63d0\u4ea4"))),r.a.createElement(O.a,{centered:!0,size:"lg",show:F,onHide:function(){return T(!1)}},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,"\u8fd1\u671f\u66f4\u65b0")),r.a.createElement(O.a.Body,null,r.a.createElement(G,{displayList:fe}))),r.a.createElement("div",{className:"button-group"},r.a.createElement("div",null,u.map((function(e){return r.a.createElement(j.a,{key:e,className:"pink-button",onClick:Ve},e)}))),r.a.createElement("div",null,t?r.a.createElement(j.a,{className:"pink-button",onClick:function(){ne(!0),_e(null),me(null),E(!0)}},"\u6dfb\u52a0\u8ffd\u756a"):r.a.createElement(r.a.Fragment,null),t?r.a.createElement(j.a,{className:"pink-button",onClick:function(){return M(!0)}},"\u6392\u540d"):r.a.createElement(r.a.Fragment,null),r.a.createElement(j.a,{className:"pink-button",onClick:function(){return T(!0)}},"\u8fd1\u671f\u66f4\u65b0"),r.a.createElement(j.a,{className:"pink-button",onClick:e.refresh},"\u5237\u65b0"))),r.a.createElement("div",null,r.a.createElement(y.a,{striped:!0,borderless:!0,hover:!0,size:"sm",variant:"light",id:"table"},r.a.createElement("thead",null,r.a.createElement("tr",{className:"table-headers"},["\u6392\u540d","\u540d\u79f0","\u5206\u7c7b","\u5b63\u5ea6","\u5f00\u59cb\u653e\u9001\u65e5\u671f","\u66f4\u65b0\u65e5","\u9884\u8ba1\u96c6\u6570","\u72b6\u6001",""].map((function(e){return"\u66f4\u65b0\u65e5"===e||"\u6392\u540d"===e||"\u5f00\u59cb\u653e\u9001\u65e5\u671f"===e?r.a.createElement(N,{key:e,header:e,sort:function(){return Se(D(e))}}):r.a.createElement("th",{key:e},e)})))),r.a.createElement("tbody",null,fe.map((function(e){return r.a.createElement("tr",{key:e.name},r.a.createElement("td",null,U[e.name]),r.a.createElement("td",{className:"anime-name"},e.name),r.a.createElement("td",null,e.genre),r.a.createElement("td",null,e.season),r.a.createElement("td",null,e.start_date),r.a.createElement("td",null,e.next_episode_day),r.a.createElement("td",null,Y(e.tv_episodes,0)),r.a.createElement("td",null,e.status),r.a.createElement("td",null," ",t?r.a.createElement(r.a.Fragment,null,r.a.createElement(k.a,{className:"clickable",onClick:function(){me(e.id),_e({name:e.name,tv_episodes:e.tv_episodes,genre:e.genre,description:e.description,start_date:e.start_date,next_episode_day:e.next_episode_day,season:e.season,status:e.status}),ne(!1),E(!0)}}),r.a.createElement(k.c,{className:"icon clickable",onClick:function(){ue({name:e.name,id:e.id}),L(!0)}})):r.a.createElement(r.a.Fragment,null)))}))))))},U=a(359),W=(a(378),Object(n.createContext)(null));function K(){return Object(n.useContext)(W)}function X(e){var t=p().authenticated,a=K(),n=a.setQuoteToEdit,l=a.setShowQuoteModal,c=a.setIsNewQuote,u=a.setActiveQuoteId,i=a.setShowDeleteConfirmation;return r.a.createElement("blockquote",null,r.a.createElement("div",{className:"quote-content"},e.quote.content),r.a.createElement("div",{className:"quote-translation"},e.quote.translation),r.a.createElement("cite",null,e.quote.person+"\u300a"+e.quote.bangumi+"\u300b",t?r.a.createElement(k.a,{className:"icon clickable",onClick:function(){c(!1),n(e.quote),l(!0)}}):r.a.createElement(r.a.Fragment,null),t?r.a.createElement(k.c,{className:"icon clickable",onClick:function(){u(e.quote.id),i(!0)}}):r.a.createElement(r.a.Fragment,null)))}function $(e){var t=p().authenticated,a=K(),n=a.setIsNewQuote,l=a.setQuoteToEdit,c=a.addNewQuote;return r.a.createElement("div",{className:"summary"},r.a.createElement("div",{className:"summary-title"},r.a.createElement("div",{className:"summary-info"},r.a.createElement("div",{className:"year-month"},r.a.createElement("div",{className:"month"},H()(e.month).format("MM")),r.a.createElement("div",{className:"year"},H()(e.month).format("YYYY")),r.a.createElement("div",{className:"yue"},"\u6708")),r.a.createElement("div",{className:"summary-info-pieces"},r.a.createElement("div",{className:"summary-info-piece"},"\u756a\u5267\u603b\u6570\uff1a"+e.summary.bangumi_num),r.a.createElement("div",{className:"summary-info-piece"},"\u603b\u96c6\u6570\uff1a"+e.summary.tv_episode_num),r.a.createElement("div",{className:"summary-info-piece"},"\u603b\u65f6\u957f\uff1a"+I(e.summary.total_time)),r.a.createElement("div",{className:"summary-info-piece"},"\u6bcf\u65e5\u65f6\u957f\uff1a"+I(e.summary.total_time/H()(e.month).daysInMonth())))),r.a.createElement("div",{className:"summary-quotes"},0!==e.summary.quotes.length?r.a.createElement(r.a.Fragment,null,e.summary.quotes.map((function(t){return r.a.createElement(X,{quote:t,setActiveQuoteId:e.setActiveQuoteId})})),t?r.a.createElement(U.a,{className:"clickable add-more-quote-button",onClick:function(){c(e.month),n(!0),l({})}}):r.a.createElement(r.a.Fragment,null)):t?r.a.createElement(j.a,{className:"pink-button add-quote-button",onClick:function(){c(e.month),l({})}},"\u6dfb\u52a0\u8bed\u5f55"):r.a.createElement("div",{className:"add-quote-button"},"\u6682\u65e0\u8bed\u5f55"))),r.a.createElement("div",{className:"summary-names"},e.summary.bangumis.map((function(e){return r.a.createElement("div",{className:"bangumi-name"},"\u2022 "+e)}))))}var Z=function(e){var t=Object(n.useContext)(h).monthlySummaries,a=Object(n.useState)(!0),l=Object(s.a)(a,2),c=l[0],u=l[1],i=Object(n.useState)(!1),o=Object(s.a)(i,2),m=o[0],d=o[1],E=Object(n.useState)(!1),f=Object(s.a)(E,2),p=f[0],b=f[1],v=Object(n.useState)(),g=Object(s.a)(v,2),y=g[0],w=g[1],k=Object(n.useState)({}),N=Object(s.a)(k,2),S=N[0],C=N[1],L=Object(n.useState)(""),x=Object(s.a)(L,2),V=x[0],Y=x[1],I=function(e){d(!0),Y(e)};return r.a.createElement("div",{className:"monthly-summary"},r.a.createElement(O.a,{centered:!0,size:"lg",show:m,onHide:function(){return d(!1)}},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,c?"\u6dfb\u52a0\u65b0\u8bed\u5f55":"\u7f16\u8f91\u8bed\u5f55")),r.a.createElement(O.a.Body,null,r.a.createElement(_.a,{onSubmit:function(t){c?(t.preventDefault(),e.onQuoteSubmit(t,V,S.id,!0)):(t.preventDefault(),e.onQuoteSubmit(t,S.month,S.id,!1)),d(!1)}},r.a.createElement(_.a.Group,{controlId:"content"},r.a.createElement(_.a.Label,null,"\u8bed\u5f55\u539f\u6587"),r.a.createElement(_.a.Control,{defaultValue:S.content,type:"input",as:"textarea",rows:"3"})),r.a.createElement(_.a.Group,{controlId:"translation"},r.a.createElement(_.a.Label,null,"\u4e2d\u6587\u7ffb\u8bd1"),r.a.createElement(_.a.Control,{defaultValue:S.translation,type:"input",as:"textarea",rows:"3"})),r.a.createElement(_.a.Row,{className:"input-row"},r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u4eba\u7269"),r.a.createElement(_.a.Control,{defaultValue:S.person,id:"person",type:"input"})),r.a.createElement(A.a,null,r.a.createElement(_.a.Label,null,"\u4f5c\u54c1"),r.a.createElement(_.a.Control,{defaultValue:S.bangumi,id:"bangumi",type:"input"}))),r.a.createElement(j.a,{className:"pink-button",type:"submit"},"\u63d0\u4ea4")))),r.a.createElement(O.a,{centered:!0,size:"sm",show:p,onHide:function(){return b(!1)}},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,"\u5220\u9664\u8bed\u5f55")),r.a.createElement(O.a.Body,null,r.a.createElement("p",null,"\u786e\u5b9a\u8981\u5220\u9664\u6b64\u8bed\u5f55\u5417")),r.a.createElement(O.a.Footer,null,r.a.createElement(j.a,{variant:"primary",onClick:function(){w(null),b(!1)}},"\u53d6\u6d88"),r.a.createElement(j.a,{variant:"danger",onClick:function(){e.deleteQuote(y),w(null),b(!1)}},"\u786e\u5b9a"))),function(e){for(var t=[],a=0,n=Object.entries(e);a<n.length;a++){var r=Object(s.a)(n[a],2),l=r[0],c=r[1];t.push([l,c])}return t.sort((function(e,t){return-1*e[0].localeCompare(t[0])})),t}(t).map((function(e){return r.a.createElement(W.Provider,{value:{setIsNewQuote:u,setShowQuoteModal:d,addNewQuote:I,setQuoteToEdit:C,setActiveQuoteId:w,setShowDeleteConfirmation:b}},r.a.createElement($,{month:e[0],summary:e[1]}))})))};a(379);function ee(){var e=p(),t=e.username,a=e.password,n=e.setAuthenticating,l=e.setUsername,c=e.setPassword,u=e.handleLogin;return r.a.createElement("div",{className:"Login"},r.a.createElement(_.a,{onSubmit:u},r.a.createElement(_.a.Group,{size:"lg",controlId:"username"},r.a.createElement(_.a.Label,null,"\u7528\u6237\u540d"),r.a.createElement(_.a.Control,{autoFocus:!0,type:"username",value:t,onChange:function(e){return l(e.target.value)}})),r.a.createElement(_.a.Group,{size:"lg",controlId:"password"},r.a.createElement(_.a.Label,null,"\u5bc6\u7801"),r.a.createElement(_.a.Control,{type:"password",value:a,onChange:function(e){return c(e.target.value)}})),r.a.createElement("div",{className:"button-group"},r.a.createElement(j.a,{className:"pink-button",size:"lg",type:"submit",disabled:!(t.length>0&&a.length>0)},"\u767b\u9646"),r.a.createElement(j.a,{className:"pink-button",size:"lg",type:"submit",onClick:function(){return n(!1)}},"\u53d6\u6d88"))))}a(380);var te=a(20),ae=a.n(te);ae.a.initialize(m.APPLICATION_ID,m.JAVASCRIPT_KEY),ae.a.serverURL=m.SERVER_URL;var ne=function(){var e=Object(n.useState)(!1),t=Object(s.a)(e,2),a=t[0],l=t[1],c=Object(n.useState)(!1),u=Object(s.a)(c,2),m=u[0],d=u[1],E=Object(n.useState)(""),p=Object(s.a)(E,2),b=p[0],g=p[1],y=Object(n.useState)(""),O=Object(s.a)(y,2),j=O[0],_=O[1],w=Object(n.useState)(function(){var e=sessionStorage.getItem("user");return e?JSON.parse(e):null}()),k=Object(s.a)(w,2),N=k[0],S=k[1],C=Object(n.useState)(sessionStorage.getItem("token")||null),L=Object(s.a)(C,2),x=L[0],A=L[1],V=Object(n.useState)(!0),Y=Object(s.a)(V,2),I=Y[0],M=Y[1],D=Object(n.useState)(!1),Q=Object(s.a)(D,2),F=Q[0],T=Q[1],q=Object(n.useState)("AnimeList"),z=Object(s.a)(q,2),G=z[0],P=z[1],U=Object(n.useState)([]),W=Object(s.a)(U,2),K=W[0],X=W[1],$=Object(n.useState)([]),te=Object(s.a)($,2),ne=te[0],re=te[1],le=Object(n.useState)({}),ce=Object(s.a)(le,2),ue=ce[0],ie=ce[1],oe=Object(n.useState)([]),se=Object(s.a)(oe,2),me=se[0],de=se[1],Ee=function(){var e=Object(o.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:M(!0),t=ae.a.Object.extend("Ratings"),(a=new ae.a.Query(t)).limit(1e3),a.find().then((function(e){if(console.log("calling server for ratings"),"undefined"!==typeof document){var t=e.map((function(e){return{id:e.id,name:e.get("name"),year:e.get("year"),douban:e.get("douban"),tv_episodes:e.get("tv_episodes"),movies:e.get("movies"),episode_length:e.get("episode_length"),status:e.get("status"),genre:e.get("genre"),description:e.get("description"),story:e.get("story"),illustration:e.get("illustration"),music:e.get("music"),passion:e.get("passion"),rating:Number((e.get("story")+e.get("illustration")+e.get("music")+e.get("passion")).toFixed(1)),start_date:H()(e.get("start_date"),"YYYY-MM-DD"),end_date:H()(e.get("end_date"),"YYYY-MM-DD"),times_watched:e.get("times_watched")}}));X(R(t,"start_date")),M(!1)}}),(function(e){M(!1),T(!0),console.error("Error while fetching ratings",e)}));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),fe=function(){var e=Object(o.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=ae.a.Object.extend("Quotes"),(a=new ae.a.Query(t)).limit(1e3),a.find().then((function(e){if(console.log("calling server for quotes"),"undefined"!==typeof document){var t=e.map((function(e){return{id:e.id,month:e.get("month"),content:e.get("content"),translation:e.get("translation"),person:e.get("person"),bangumi:e.get("bangumi")}}));de(t)}}),(function(e){T(!0),console.error("Error while fetching quotes",e)}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),pe=function(){var e=Object(o.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:M(!0),t=ae.a.Object.extend("NewAnimes"),(a=new ae.a.Query(t)).limit(1e3),a.find().then((function(e){if(console.log("calling server for new animes"),"undefined"!==typeof document){var t=e.map((function(e){return{id:e.id,name:e.get("name"),genre:e.get("genre"),seasons_ranking:e.get("seasons_ranking"),start_date:e.get("start_date"),next_episode_day:e.get("next_episode_day"),tv_episodes:e.get("tv_episodes"),description:e.get("description"),season:e.get("season"),status:e.get("status")}}));re(t),M(!1)}}),(function(e){M(!1),T(!0),console.error("Error while fetching new animes",e)}));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),be=function(){var e=Object(o.a)(i.a.mark((function e(t,a){var n,r,l,c,u,o,m,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ae.a.Object.extend(a),(r=new ae.a.Query(n)).equalTo("name",t.name),e.next=5,r.find();case 5:if(e.sent.length>0)alert("\u756a\u5267\u300a"+t.name+"\u300b\u5df2\u5b58\u5728\uff01\u8bf7\u52ff\u91cd\u590d\u6dfb\u52a0\u756a\u5267\uff01");else{for(l=new n,c=0,u=Object.entries(t);c<u.length;c++)o=Object(s.a)(u[c],2),m=o[0],d=o[1],l.set(m,d);l.save().then((function(e){alert("\u5df2\u63d0\u4ea4\u756a\u5267\u4fe1\u606f\uff01"),"Ratings"===a?Ee():"NewAnimes"===a&&pe()}),(function(e){alert("\u66f4\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002")}))}case 7:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),ve=function(){var e=Object(o.a)(i.a.mark((function e(t){var a,n,r,l,c,u,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=ae.a.Object.extend("Quotes"),n=new a,r=0,l=Object.entries(t);r<l.length;r++)c=Object(s.a)(l[r],2),u=c[0],o=c[1],n.set(u,o);n.save().then((function(e){alert("\u5df2\u6dfb\u52a0\u8bed\u5f55\uff01"),fe()}),(function(e){alert("\u6dfb\u52a0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002")}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ge=function(){var e=Object(o.a)(i.a.mark((function e(t,a,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=ae.a.Object.extend(n),new ae.a.Query(r).get(t).then((function(e){for(var t=0,r=Object.entries(a);t<r.length;t++){var l=Object(s.a)(r[t],2),c=l[0],u=l[1];e.set(c,u)}e.save().then((function(e){alert("\u5df2\u66f4\u65b0\u756a\u5267\u4fe1\u606f\uff01"),"Ratings"===n?Ee():"NewAnimes"===n&&pe()}),(function(e){alert("\u66f4\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002")}))}));case 3:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),he=function(){var e=Object(o.a)(i.a.mark((function e(t,a){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=ae.a.Object.extend("Quotes"),new ae.a.Query(n).get(t).then((function(e){for(var t=0,n=Object.entries(a);t<n.length;t++){var r=Object(s.a)(n[t],2),l=r[0],c=r[1];e.set(l,c)}e.save().then((function(e){alert("\u5df2\u66f4\u65b0\u8bed\u5f55\uff01"),fe()}),(function(e){alert("\u66f4\u65b0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002")}))}));case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),ye=function(){var e=Object(o.a)(i.a.mark((function e(t,a,n){var r,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=ae.a.Object.extend("NewAnimes"),(l=new ae.a.Query(r)).containedIn("objectId",t),l.find().then((function(e){e.forEach((function(e){e.set("seasons_ranking",a[e.id])})),ae.a.Object.saveAll(e).then((function(e){alert("\u5df2\u66f4\u65b0\u6392\u540d\uff01"),pe()}),(function(e){alert("\u66f4\u65b0\u6392\u540d\u5931\u8d25\u3002")}))}),(function(e){alert("\u66f4\u65b0\u6392\u540d\u5931\u8d25\u3002")}));case 4:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),Oe=function(){var e=Object(o.a)(i.a.mark((function e(t,a){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=ae.a.Object.extend(a),new ae.a.Query(n).get(t).then((function(e){e.destroy().then((function(e){alert("\u5df2\u5220\u9664\u756a\u5267\uff01"),"Ratings"===a?Ee():"NewAnimes"===a&&pe()}),(function(e){alert("\u5220\u9664\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002")}))}));case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),je=function(){var e=Object(o.a)(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=ae.a.Object.extend("Quotes"),new ae.a.Query(a).get(t).then((function(e){e.destroy().then((function(e){alert("\u5df2\u5220\u9664\u8bed\u5f55\uff01"),fe()}),(function(e){alert("\u5220\u9664\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002")}))}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){Ee(),pe(),fe()}),[]),Object(n.useEffect)((function(){var e={};K.filter((function(e){return"\u5df2\u770b"===e.status})).forEach((function(t){var a=H()(t.end_date).format("YYYY-MM");a in e||(e[a]={bangumi_num:0,tv_episode_num:0,movie_num:0,total_time:0,daily_time:0,bangumis:[],quotes:[]}),e[a].bangumi_num+=1,e[a].bangumis.push(t.name),e[a].tv_episode_num+=t.tv_episodes,e[a].movie_num+=t.movies,e[a].total_time+=t.tv_episodes*t.episode_length+90*t.movies})),me.forEach((function(t){var a=H()(t.month).format("YYYY-MM");a in e&&e[a].quotes.push(t)})),ie(e)}),[K,me]),Object(n.useEffect)((function(){null!=N&&null!=x&&l(!0)}),[N,x]);var _e=function(e,t,a){e.preventDefault();var n=e.target.elements,r={name:n.name.value,year:n.year.value,douban:Number(n.douban.value),tv_episodes:Number(n.tv_episodes.value),movies:Number(n.movies.value),episode_length:Number(n.episode_length.value),status:n.status.value,genre:n.genre.value,description:n.description.value,story:Number(n.story.value),illustration:Number(n.illustration.value),music:Number(n.music.value),passion:Number(n.passion.value),start_date:n.start_date.value,end_date:n.end_date.value,times_watched:Number(n.times_watched.value)};a?be(r,"Ratings"):ge(t,r,"Ratings")},we=function(e,t,a){e.preventDefault();var n=e.target.elements,r={name:n.name.value,tv_episodes:Number(n.tv_episodes.value),genre:n.genre.value,description:n.description.value,start_date:n.start_date.value,next_episode_day:n.next_episode_day.value,season:n.season.value,status:n.status.value};a?be(r,"NewAnimes"):ge(t,r,"NewAnimes")},ke=function(e,t,a,n){e.preventDefault();var r=e.target.elements,l={month:t,content:r.content.value,translation:r.translation.value,person:r.person.value,bangumi:r.bangumi.value};n?ve(l):he(a,l)};return r.a.createElement("div",null,r.a.createElement("div",{className:"App"},r.a.createElement(f.Provider,{value:{username:b,password:j,authenticated:a,setAuthenticating:d,handleLogin:function(e){e.preventDefault(),ae.a.User.logIn(b,j).then((function(e){!function(e,t){sessionStorage.setItem("token",t),sessionStorage.setItem("user",JSON.stringify(e))}(e,e.getSessionToken()),alert("\u6b22\u8fce\uff0c"+e.getUsername()),d(!1),l(!0)})).catch((function(e){alert(e.message)}))},handleSignOut:function(){S(null),A(null),sessionStorage.removeItem("token"),sessionStorage.removeItem("user"),l(!1)},setUsername:g,setPassword:_}},r.a.createElement(v,{switchPage:P}),m?r.a.createElement(ee,null):r.a.createElement(h.Provider,{value:{ratings:K,monthlySummaries:ue,newAnimes:ne}},function(e){switch(e){case"AnimeList":return r.a.createElement(B,{isLoading:I,loadError:F,refresh:Ee,onAnimeSubmit:_e,deleteAnime:Oe});case"NewAnimeList":return r.a.createElement(J,{isLoading:I,loadError:F,refresh:pe,onAnimeSubmit:_e,onNewAnimeSubmit:we,updateEntry:ge,deleteNewAnime:Oe,updateNewAnimesRankings:ye});case"MonthlySummary":return r.a.createElement(Z,{onQuoteSubmit:ke,deleteQuote:je});default:return r.a.createElement(B,{isLoading:I,loadError:F,refresh:Ee,onAnimeSubmit:_e,deleteAnime:Oe})}}(G)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(ne,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[736,1,2]]]);
//# sourceMappingURL=main.cdd69dc5.chunk.js.map